# Руководство по системе платежей ARTEnet Bank

## Обзор системы

Система платежей ARTEnet Bank позволяет создавать защищенные ссылки для онлайн-платежей с поддержкой конвертации валют и автоматической записью в историю операций.

## Основные компоненты

### 1. Единый конвертер валют (`js/currency-converter.js`)

Новый единый скрипт конвертации валют для всего банка:

- **Автоматическое обновление курсов** с API каждые 60 минут
- **Поддержка 8 валют**: EUR, USD, RUB, GBP, CHF, JPY, CNY, KRW
- **Конвертация с комиссией** (0.5% за конвертацию)
- **Fallback на базовые курсы** при недоступности API

#### Использование:
```javascript
// Простая конвертация
const amount = await window.currencyConverter.convert(100, 'USD', 'EUR');

// Конвертация с комиссией
const result = await window.currencyConverter.convertWithFee(100, 'USD', 'EUR');
// result = { originalAmount: 100, convertedAmount: 92.59, fee: 0.46, total: 93.05, rate: 0.9259 }
```

### 2. Онлайн-платежи (`apps/zelen/payments.html`)

Страница для выполнения платежей через защищенные ссылки.

#### Особенности:
- **Конвертация валют** при необходимости
- **Отображение имени и фамилии** получателя вместо названия организации
- **Генерация ссылок по URL** с параметрами
- **Автоматическая запись в историю** после успешного платежа

#### Генерация ссылок по URL:

**Способ 1: Создание новой ссылки**
```
apps/zelen/payments.html?generate=true&amount=29.99&currency=EUR&description=Подписка&recipient=Иван Петров
```

**Способ 2: Использование существующей ссылки**
```
apps/zelen/payments.html?payment=PAYMENT_ID
```

**Способ 3: Перевод на конкретный счет**
```
apps/zelen/payments.html?generate=true&amount=50&currency=EUR&description=Перевод&toAccount=1234-5678-9012
```

### 3. Переводы (`apps/zelen/transfer.html`)

Обновленная страница переводов с новым конвертером валют.

#### Новые возможности:
- **Автоматическая конвертация** между разными валютами
- **Комиссия за конвертацию** (0.5%)
- **Комиссия банка** (настраивается в админке)
- **Детальная сводка** с учетом всех комиссий

### 4. Курсы валют (`apps/zelen/currencies.html`)

Обновленная страница курсов валют с реальными данными.

#### Функции:
- **Отображение курсов покупки и продажи**
- **Автоматическое обновление** с внешнего API
- **Поиск валют**
- **Курсы ЦБ и банковские курсы**

## Создание платежных ссылок

### Через админку (рекомендуется)

1. Перейдите в **Админка банка** → **Ссылки для платежей**
2. Нажмите **"Создать новую ссылку"**
3. Заполните параметры:
   - **Сумма**: сумма платежа
   - **Валюта**: валюта платежа
   - **Описание**: назначение платежа
   - **Получатель**: имя и фамилия получателя
   - **Return URL**: ссылка для возврата после платежа
4. Нажмите **"Создать"**
5. Скопируйте сгенерированную ссылку

### Программная генерация

```javascript
// Создание ссылки для платежа
function createPaymentLink(amount, currency, description, recipient) {
    const params = new URLSearchParams({
        generate: 'true',
        amount: amount.toString(),
        currency: currency,
        description: description,
        recipient: recipient
    });
    
    return `apps/zelen/payments.html?${params.toString()}`;
}

// Создание ссылки для перевода
function createTransferLink(amount, currency, description, toAccount) {
    const params = new URLSearchParams({
        generate: 'true',
        amount: amount.toString(),
        currency: currency,
        description: description,
        toAccount: toAccount
    });
    
    return `apps/zelen/payments.html?${params.toString()}`;
}
```

## Процесс выполнения платежа

1. **Пользователь переходит** по платежной ссылке
2. **Система проверяет** валидность ссылки
3. **Загружаются счета** пользователя
4. **Выбирается счет** для списания
5. **Рассчитывается конвертация** (если валюты разные)
6. **Показывается сводка** с комиссиями
7. **Подтверждение паролем**
8. **Выполнение платежа** и запись в историю
9. **Перенаправление** на return URL

## Комиссии

### Комиссия за платеж
- **Настраивается в админке** (по умолчанию 2.5%)
- **Взимается в валюте счета** пользователя

### Комиссия за конвертацию
- **Фиксированная 0.5%** от суммы после конвертации
- **Взимается в целевой валюте**

### Комиссия за перевод
- **Настраивается в админке** (по умолчанию 1.5%)
- **Плюс комиссия за конвертацию** при необходимости

## Безопасность

- **Проверка авторизации** пользователя
- **Валидация платежных ссылок**
- **Подтверждение паролем** для всех операций
- **Защита от двойного списания**
- **Логирование всех операций**

## Интеграция

### Добавление на сайт

```html
<!-- Кнопка для генерации платежа -->
<button onclick="createPayment()">Оплатить</button>

<script>
function createPayment() {
    const paymentUrl = createPaymentLink(29.99, 'EUR', 'Подписка', 'ARTEnet Premium');
    window.location.href = paymentUrl;
}
</script>
```

### Обработка возврата

```javascript
// На странице успешного платежа
if (window.location.search.includes('success=true')) {
    showSuccessMessage('Платеж выполнен успешно!');
}
```

## Поддержка

При возникновении проблем:
1. Проверьте консоль браузера на ошибки
2. Убедитесь в правильности параметров ссылки
3. Проверьте настройки комиссий в админке
4. Обратитесь в поддержку: ltartenet@gmail.com

---

**Версия**: 2.0  
**Дата обновления**: 2025  
**Поддерживаемые валюты**: EUR, USD, RUB, GBP, CHF, JPY, CNY, KRW 